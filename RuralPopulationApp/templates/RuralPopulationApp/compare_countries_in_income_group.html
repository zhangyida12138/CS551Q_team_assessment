{% extends 'RuralPopulationApp/index.html' %}

{% block title %}
    Comparison of Countries in Income Group
{% endblock %}

{% block content %}
    <h1>Comparison of Countries in Income Group</h1>
    {% if error_message %}
        <div style='color: red;'>{{error_message}}</div>
    {% endif %}
    
    <!-- Form for inputting income group ID -->
    <form method="get" action="{% url 'compare_countries_in_income_group' %}">
        <label for="income_group_id">Income Group ID:</label>
        <input type="text" name="income_group_id" id="income_group_id">
        <br>
        <button type="submit">Compare</button>
    </form>

    <table>
        <thead>
            <tr>
                <th>Income Group</th>
                <th>Country</th>
                <th>Region</th>
                <th>Special Notes</th>
            </tr>
        </thead>
        <tbody>
            {% for country in countries %}
                <tr>
                    {% if country.income_group.name == 'nan' %}
                        <td>None</td>
                    {% else %}
                        <td>{{ country.income_group.name}}</td>
                    {% endif %}
                        <td>{{ country.name }}</td>
                    {% if country.income_group.name == 'nan' %}
                        <td>None</td>
                    {% else %}
                        <td>{{country.region.name}}</td>
                    {% endif %}
                    {% if country.special_notes == 'nan' %}
                        <td>None</td>
                    {% else %}
                        <td>{{ country.special_notes }}</td>
                    {% endif %}
                    <tr>
                        <th>Year</th>
                        {% for data_entry in country.dataentry_set.all %}
                            <td>{{ data_entry.year }}</td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <th>Population(%)</th>
                        {% for data_entry in country.dataentry_set.all %}
                            <td>{{ data_entry.value }}</td>
                        {% endfor %}
                    </tr>
                </table>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <div id="container" style="margin-top: 24px"></div>

    <script>
        var chart = new ej.charts.Chart({
            tooltip: { enable: true },

            // Initializing Primary X Axis
            primaryXAxis: {
                title: 'Year',
                interval: 1
            },
            // Initializing Primary Y Axis
            primaryYAxis: {
                interval: 5,
                title: 'Rural Population (% of Total Population)'
            },
            // Initializing Chart Series
            series: [
                {% for country in countries %}
                {
                    type: 'Line',
                    width: 4,
                    name: '{{ country.name }}',
                    dataSource: [
                        {% for data_entry in country.dataentry_set.all %}
                        { year: {{ data_entry.year }}, value: {{ data_entry.value }} },
                        {% endfor %}
                    ],
                    xName: 'year',
                    yName: 'value',
                    // Generate a random color for each country
                    fill: 'rgba(' + Math.floor(Math.random() * 256) + ',' + Math.floor(Math.random() * 256) + ',' + Math.floor(Math.random() * 256) + ',0.3)',
                    border: { width: 2, color: 'rgba(' + Math.floor(Math.random() * 256) + ',' + Math.floor(Math.random() * 256) + ',' + Math.floor(Math.random() * 256) + ',0.7)' }
                }{% if not forloop.last %},{% endif %}
                {% endfor %}
            ],
        });
        chart.appendTo('#container');
    </script>
{% endblock %}
